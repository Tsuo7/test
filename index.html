<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TSUO ANIME V3 | MAXIMUS EDITION</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;600;900&family=Noto+Sans+JP:wght@900&display=swap" rel="stylesheet">

    <style>
        :root { --accent: #e11d48; --bg: #050507; --card: #0f1117; --text: #f8fafc; }
        body { background: var(--bg); color: var(--text); font-family: 'Outfit', sans-serif; overflow-x: hidden; }
        
        .glass { background: rgba(15, 17, 23, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.05); }
        .anime-card { transition: all 0.3s ease; cursor: pointer; position: relative; }
        .anime-card:hover { transform: translateY(-8px); shadow: 0 20px 40px rgba(0,0,0,0.5); }
        .anime-card:hover .overlay { opacity: 1; }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        input, textarea, select { background: rgba(255,255,255,0.05) !important; border: 1px solid rgba(255,255,255,0.1) !important; color: white !important; outline: none; transition: 0.3s; }
        input:focus { border-color: var(--accent) !important; box-shadow: 0 0 15px rgba(225,29,72,0.2); }

        .star-active { color: #fbbf24; fill: #fbbf24; }
        .star-inactive { color: #475569; }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: var(--accent); border-radius: 10px; }
    </style>
</head>
<body>

<nav class="fixed top-0 w-full z-[100] glass px-6 py-4 border-b border-white/5">
    <div class="max-w-7xl mx-auto flex justify-between items-center">
        <div class="flex items-center gap-10">
            <div class="flex items-center gap-2 cursor-pointer" onclick="showSection('home')">
                <div class="w-10 h-10 bg-[var(--accent)] rounded-xl flex items-center justify-center font-black text-xl italic shadow-lg shadow-rose-900/40">T</div>
                <h1 class="text-xl font-black uppercase italic tracking-tighter hidden sm:block">TSUO <span class="text-[var(--accent)]">MAX</span></h1>
            </div>
            <div class="hidden md:flex gap-6 text-[10px] font-black uppercase tracking-widest opacity-60">
                <button onclick="showSection('home')" class="hover:text-[var(--accent)]">Início</button>
                <button onclick="showSection('mylist')" class="hover:text-[var(--accent)]">Minha Lista</button>
                <button onclick="showSection('categories')" class="hover:text-[var(--accent)]">Gêneros</button>
                <button onclick="randomSeries()" class="text-[var(--accent)] flex items-center gap-2"><i data-lucide="shuffle" class="w-3 h-3"></i> Aleatório</button>
            </div>
        </div>
        <div class="flex items-center gap-4">
            <input type="text" oninput="doSearch(this.value)" placeholder="Buscar..." class="rounded-full px-5 py-2 text-xs w-40 lg:w-64">
            <button onclick="openLogin()" class="p-2 hover:text-[var(--accent)] transition"><i data-lucide="settings"></i></button>
        </div>
    </div>
</nav>

<div id="mural-area" class="mt-28 px-6 max-w-7xl mx-auto">
    </div>

<main id="section-home" class="section pt-10 px-6 max-w-7xl mx-auto min-h-screen">
    <div id="hero-area" class="mb-16"></div>
    <div class="flex justify-between items-end mb-8">
        <h2 class="text-3xl font-black uppercase italic">Séries <span class="text-[var(--accent)]">Populares</span></h2>
    </div>
    <div id="anime-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-6 pb-32"></div>
</main>

<main id="section-mylist" class="section hidden pt-32 px-6 max-w-7xl mx-auto min-h-screen">
    <h2 class="text-4xl font-black uppercase italic mb-10"><i data-lucide="heart" class="inline mr-3 text-[var(--accent)]"></i> Minha <span class="text-[var(--accent)]">Lista</span></h2>
    <div id="mylist-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-6 pb-32"></div>
</main>

<main id="section-categories" class="section hidden pt-32 px-6 max-w-7xl mx-auto min-h-screen">
    <h2 class="text-4xl font-black uppercase italic mb-10">Explorar <span class="text-[var(--accent)]">Gêneros</span></h2>
    <div id="category-list" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4"></div>
</main>

<div id="series-modal" class="fixed inset-0 z-[1000] hidden bg-black/98 items-center justify-center p-4">
    <div class="w-full max-w-6xl glass rounded-[40px] overflow-hidden flex flex-col lg:flex-row h-[90vh] shadow-2xl relative">
        <button onclick="closeModal()" class="absolute top-6 right-6 z-50 w-12 h-12 bg-white/5 rounded-full flex items-center justify-center hover:bg-rose-600 transition"><i data-lucide="x"></i></button>
        
        <div class="flex-grow bg-black flex flex-col">
            <div id="video-container" class="flex-grow flex items-center justify-center relative bg-black">
                <video id="main-player" controls class="w-full h-full object-contain"></video>
                <div id="player-controls" class="absolute bottom-10 flex gap-4">
                    <button id="prev-ep" class="px-6 py-2 bg-white/10 rounded-full text-[10px] font-black uppercase hidden">Anterior</button>
                    <button id="next-ep" class="px-6 py-2 bg-[var(--accent)] rounded-full text-[10px] font-black uppercase hidden">Próximo</button>
                </div>
            </div>
            <div class="p-8 border-t border-white/5">
                <h3 id="m-title" class="text-3xl font-black uppercase italic mb-2">Título</h3>
                <div class="flex items-center gap-4 mb-4">
                    <div id="m-stars" class="flex gap-1 text-yellow-500"></div>
                    <span id="m-rating-val" class="text-xs font-bold opacity-50">4.5</span>
                </div>
                <p id="m-desc" class="text-sm text-gray-400 line-clamp-2"></p>
            </div>
        </div>

        <div class="w-full lg:w-80 p-8 border-l border-white/5 overflow-y-auto">
            <button id="fav-btn" onclick="toggleFavorite()" class="w-full py-4 mb-6 rounded-2xl border border-white/10 flex items-center justify-center gap-3 font-black text-[10px] uppercase hover:bg-rose-600/20 transition">
                <i data-lucide="heart" class="w-4 h-4"></i> Adicionar à Lista
            </button>
            <h4 class="text-[10px] font-black uppercase opacity-40 mb-4 tracking-widest">Episódios</h4>
            <div id="episode-list" class="space-y-2"></div>
        </div>
    </div>
</div>

<div id="login-modal" class="fixed inset-0 z-[2000] hidden bg-black/90 backdrop-blur-xl items-center justify-center">
    <div class="bg-[var(--card)] p-12 rounded-[50px] w-full max-w-sm text-center border border-white/5">
        <h3 class="text-2xl font-black uppercase italic mb-10">Master <span class="text-[var(--accent)]">Key</span></h3>
        <input type="password" id="admin-pass" placeholder="CHAVE DE ACESSO" class="w-full p-5 rounded-2xl mb-8 text-center tracking-[1em] font-black">
        <button onclick="tryLogin()" class="w-full py-5 bg-[var(--accent)] rounded-2xl font-black uppercase text-[10px]">Entrar no Painel</button>
    </div>
</div>

<div id="admin-panel" class="fixed inset-0 z-[3000] hidden bg-[#08090d] flex overflow-hidden">
    <aside class="w-72 border-r border-white/5 p-10 flex flex-col bg-[#0c0e14]">
        <h2 class="text-xl font-black uppercase mb-12 italic">Admin <span class="text-[var(--accent)]">V3</span></h2>
        <nav class="flex-grow space-y-3">
            <button onclick="openTab('series')" class="w-full text-left p-4 rounded-xl text-[10px] font-black uppercase active">Séries & Episódios</button>
            <button onclick="openTab('tags')" class="w-full text-left p-4 rounded-xl text-[10px] font-black uppercase">Tags</button>
            <button onclick="openTab('config')" class="w-full text-left p-4 rounded-xl text-[10px] font-black uppercase">Site & Mural</button>
        </nav>
        <button onclick="location.reload()" class="p-5 bg-white/5 rounded-xl font-black text-[10px] uppercase">Sair</button>
    </aside>

    <main class="flex-grow p-16 overflow-y-auto">
        <div id="tab-series" class="tab-content active">
            <div class="grid lg:grid-cols-2 gap-12">
                <div class="space-y-6">
                    <h3 class="text-2xl font-black italic uppercase">Cadastrar <span class="text-[var(--accent)]">Série</span></h3>
                    <input type="hidden" id="edit-id">
                    <input type="text" id="v-title" placeholder="Nome do Anime" class="w-full p-4 rounded-xl">
                    <input type="text" id="v-thumb" placeholder="URL da Capa" class="w-full p-4 rounded-xl">
                    <textarea id="v-desc" placeholder="Sinopse..." class="w-full p-4 rounded-xl h-24"></textarea>
                    
                    <div class="p-6 bg-white/5 rounded-2xl border border-white/5">
                        <p class="text-[10px] font-black uppercase opacity-40 mb-4">Gerenciar Episódios</p>
                        <div id="ep-inputs" class="space-y-2 mb-4"></div>
                        <button onclick="addEpField()" class="text-[10px] font-black uppercase text-[var(--accent)]">+ Adicionar Episódio</button>
                    </div>

                    <div class="p-6 bg-white/5 rounded-2xl">
                        <p class="text-[10px] font-black uppercase opacity-40 mb-4">Tags</p>
                        <div id="admin-tag-checks" class="flex flex-wrap gap-2"></div>
                    </div>
                    <button onclick="saveSeries()" class="w-full py-5 bg-[var(--accent)] rounded-2xl font-black uppercase italic">Salvar Série</button>
                </div>
                <div class="bg-white/5 p-8 rounded-3xl overflow-y-auto max-h-[700px]">
                    <h4 class="text-xs font-black uppercase mb-6 opacity-30">Séries Postadas</h4>
                    <div id="admin-series-list" class="space-y-2"></div>
                </div>
            </div>
        </div>

        <div id="tab-tags" class="tab-content">
            <h3 class="text-2xl font-black italic uppercase mb-10">Gerenciar <span class="text-[var(--accent)]">Tags</span></h3>
            <div class="flex gap-4 mb-10 max-w-xl">
                <input type="text" id="new-tag-name" placeholder="Ex: Ação" class="flex-grow p-4 rounded-xl">
                <input type="color" id="new-tag-color" value="#e11d48" class="w-20 h-14 rounded-xl p-1 bg-white/10">
                <button onclick="createTag()" class="px-8 bg-[var(--accent)] rounded-xl font-black text-[10px] uppercase">Criar</button>
            </div>
            <div id="admin-tag-list" class="grid grid-cols-4 gap-4"></div>
        </div>

        <div id="tab-config" class="tab-content">
            <h3 class="text-2xl font-black italic uppercase mb-10">Global <span class="text-[var(--accent)]">Settings</span></h3>
            <div class="max-w-2xl space-y-8">
                <div>
                    <label class="text-[10px] font-black uppercase opacity-40">Título do Mural de Avisos</label>
                    <input type="text" id="cfg-mural-title" class="w-full p-4 rounded-xl mt-2">
                </div>
                <div>
                    <label class="text-[10px] font-black uppercase opacity-40">Mensagem do Mural</label>
                    <textarea id="cfg-mural-msg" class="w-full p-4 rounded-xl mt-2 h-24"></textarea>
                </div>
                <button onclick="saveConfig()" class="w-full py-5 bg-white text-black font-black rounded-2xl uppercase">Atualizar Mural e Site</button>
            </div>
        </div>
    </main>
</div>

<script>
    // --- DB V3 ---
    let db = JSON.parse(localStorage.getItem('tsuo_v3_db')) || {
        series: [],
        tags: [{id: 1, name: 'Ação', color: '#ff4d4d'}, {id: 2, name: 'Sci-Fi', color: '#0ea5e9'}],
        config: { mural_title: 'NOVO LANÇAMENTO', mural_msg: 'Confira agora o episódio final de Chainsaw Man!', name: 'TSUO ANIME' },
        favorites: []
    };

    let currentSeries = null;
    let currentEpIndex = 0;

    function save() { localStorage.setItem('tsuo_v3_db', JSON.stringify(db)); }

    // --- RENDERERS ---
    function renderAll() {
        renderMural();
        renderHome();
        renderCategories();
        lucide.createIcons();
    }

    function renderMural() {
        const area = document.getElementById('mural-area');
        area.innerHTML = `
            <div class="p-8 bg-gradient-to-r from-rose-900/40 to-black rounded-[30px] border border-rose-500/20 flex flex-col md:flex-row justify-between items-center gap-6">
                <div>
                    <span class="px-3 py-1 bg-rose-600 rounded-full text-[8px] font-black uppercase italic tracking-widest">Aviso Oficial</span>
                    <h3 class="text-xl font-black uppercase italic mt-2">${db.config.mural_title}</h3>
                    <p class="text-xs text-gray-400 mt-1">${db.config.mural_msg}</p>
                </div>
                <button onclick="showSection('home')" class="px-10 py-4 bg-white text-black font-black uppercase text-[10px] rounded-2xl hover:scale-105 transition">Entendido</button>
            </div>
        `;
    }

    function renderHome() {
        const grid = document.getElementById('anime-grid');
        grid.innerHTML = db.series.map(s => `
            <div class="anime-card" onclick="openSeries(${s.id})">
                <div class="relative aspect-[3/4.5] rounded-2xl overflow-hidden mb-3 shadow-xl">
                    <img src="${s.thumb}" class="w-full h-full object-cover">
                    <div class="overlay absolute inset-0 bg-black/60 opacity-0 flex items-center justify-center transition">
                        <i data-lucide="play" class="w-10 h-10 text-[var(--accent)] fill-[var(--accent)]"></i>
                    </div>
                </div>
                <h4 class="text-[11px] font-black uppercase italic truncate">${s.title}</h4>
                <div class="flex items-center justify-between mt-1">
                    <span class="text-[8px] opacity-40 font-bold uppercase">${s.episodes.length} EPISÓDIOS</span>
                    <div class="flex text-yellow-500 scale-75 origin-right"><i data-lucide="star" class="w-3 h-3 fill-current"></i></div>
                </div>
            </div>
        `).join('');

        // Hero
        const hero = document.getElementById('hero-area');
        if(db.series.length > 0) {
            const s = db.series[0];
            hero.innerHTML = `
                <div class="relative w-full h-[450px] rounded-[40px] overflow-hidden group cursor-pointer" onclick="openSeries(${s.id})">
                    <img src="${s.thumb}" class="w-full h-full object-cover scale-110 group-hover:scale-100 transition duration-1000">
                    <div class="absolute inset-0 bg-gradient-to-r from-black via-black/20 to-transparent p-12 flex flex-col justify-end">
                        <h2 class="text-6xl font-black uppercase italic mb-4">${s.title}</h2>
                        <div class="flex gap-2 mb-6">
                            ${s.tags.map(tid => `<span class="px-3 py-1 glass rounded-lg text-[8px] font-black uppercase">${db.tags.find(t => t.id == tid)?.name}</span>`).join('')}
                        </div>
                        <button class="w-fit px-12 py-5 bg-[var(--accent)] rounded-2xl font-black uppercase italic text-xs">Começar a Assistir</button>
                    </div>
                </div>
            `;
        }
        lucide.createIcons();
    }

    // --- LOGICA SERIES & PLAYER ---
    function openSeries(id) {
        currentSeries = db.series.find(s => s.id == id);
        currentEpIndex = 0;
        
        document.getElementById('m-title').innerText = currentSeries.title;
        document.getElementById('m-desc').innerText = currentSeries.desc;
        
        // Render Stars
        const stars = document.getElementById('m-stars');
        stars.innerHTML = '';
        for(let i=1; i<=5; i++) stars.innerHTML += `<i data-lucide="star" class="w-4 h-4 ${i <= 4 ? 'star-active' : 'star-inactive'}"></i>`;
        
        // Render Episodes
        const list = document.getElementById('episode-list');
        list.innerHTML = currentSeries.episodes.map((ep, i) => `
            <div onclick="playEpisode(${i})" class="p-4 bg-white/5 rounded-2xl border border-white/5 cursor-pointer hover:bg-[var(--accent)] transition flex justify-between items-center group">
                <span class="text-[10px] font-black uppercase">EP ${i+1}: ${ep.title}</span>
                <i data-lucide="play" class="w-3 h-3 opacity-0 group-hover:opacity-100"></i>
            </div>
        `).join('');

        // Check Favorite
        updateFavBtn();
        
        document.getElementById('series-modal').style.display = 'flex';
        playEpisode(0);
        lucide.createIcons();
    }

    function playEpisode(index) {
        currentEpIndex = index;
        const ep = currentSeries.episodes[index];
        const player = document.getElementById('main-player');
        player.src = ep.url;
        player.play();

        // Control buttons
        document.getElementById('prev-ep').style.display = index > 0 ? 'block' : 'none';
        document.getElementById('next-ep').style.display = index < currentSeries.episodes.length - 1 ? 'block' : 'none';
        
        document.getElementById('prev-ep').onclick = () => playEpisode(index - 1);
        document.getElementById('next-ep').onclick = () => playEpisode(index + 1);
    }

    function toggleFavorite() {
        if(db.favorites.includes(currentSeries.id)) {
            db.favorites = db.favorites.filter(id => id != currentSeries.id);
        } else {
            db.favorites.push(currentSeries.id);
        }
        save();
        updateFavBtn();
        renderMyList();
    }

    function updateFavBtn() {
        const btn = document.getElementById('fav-btn');
        const isFav = db.favorites.includes(currentSeries.id);
        btn.innerHTML = isFav ? `<i data-lucide="heart" class="w-4 h-4 fill-rose-600 text-rose-600"></i> Na Minha Lista` : `<i data-lucide="heart" class="w-4 h-4"></i> Adicionar à Lista`;
        lucide.createIcons();
    }

    function renderMyList() {
        const grid = document.getElementById('mylist-grid');
        const favs = db.series.filter(s => db.favorites.includes(s.id));
        if(favs.length === 0) { grid.innerHTML = `<p class="opacity-20 italic">Sua lista está vazia...</p>`; return; }
        grid.innerHTML = favs.map(s => `
             <div class="anime-card" onclick="openSeries(${s.id})">
                <img src="${s.thumb}" class="w-full aspect-[3/4.5] object-cover rounded-2xl mb-3 shadow-xl">
                <h4 class="text-[11px] font-black uppercase italic">${s.title}</h4>
            </div>
        `).join('');
    }

    function randomSeries() {
        if(db.series.length === 0) return;
        const rand = db.series[Math.floor(Math.random() * db.series.length)];
        openSeries(rand.id);
    }

    // --- ADMIN ACTIONS ---
    function addEpField(title = '', url = '') {
        const div = document.createElement('div');
        div.className = "flex gap-2";
        div.innerHTML = `
            <input type="text" placeholder="Nome Ep" value="${title}" class="v-ep-title flex-grow p-3 rounded-xl text-[10px]">
            <input type="text" placeholder="URL ou Arquivo" value="${url}" class="v-ep-url flex-grow p-3 rounded-xl text-[10px]">
            <button onclick="this.parentElement.remove()" class="text-red-500">X</button>
        `;
        document.getElementById('ep-inputs').appendChild(div);
    }

    function saveSeries() {
        const epTitles = document.querySelectorAll('.v-ep-title');
        const epUrls = document.querySelectorAll('.v-ep-url');
        let episodes = [];
        epTitles.forEach((el, i) => {
            if(el.value) episodes.push({ title: el.value, url: epUrls[i].value });
        });

        const id = document.getElementById('edit-id').value;
        const series = {
            id: id ? parseInt(id) : Date.now(),
            title: document.getElementById('v-title').value,
            thumb: document.getElementById('v-thumb').value,
            desc: document.getElementById('v-desc').value,
            tags: Array.from(document.querySelectorAll('.v-tag-check:checked')).map(i => parseInt(i.value)),
            episodes: episodes
        };

        if(id) db.series[db.series.findIndex(x => x.id == id)] = series;
        else db.series.unshift(series);

        save(); renderAll(); renderAdminSeries(); resetForm();
        alert("Série Sincronizada!");
    }

    function renderAdminSeries() {
        const list = document.getElementById('admin-series-list');
        list.innerHTML = db.series.map(s => `
            <div class="flex justify-between items-center p-4 bg-white/5 rounded-xl">
                <span class="text-[10px] font-black uppercase">${s.title}</span>
                <div class="flex gap-3">
                    <button onclick="editSeries(${s.id})" class="text-blue-500 font-black text-[9px]">EDIT</button>
                    <button onclick="deleteSeries(${s.id})" class="text-red-500 font-black text-[9px]">DEL</button>
                </div>
            </div>
        `).join('');

        const checks = document.getElementById('admin-tag-checks');
        checks.innerHTML = db.tags.map(t => `
            <label class="flex items-center gap-2 p-2 bg-white/5 rounded-lg cursor-pointer">
                <input type="checkbox" value="${t.id}" class="v-tag-check">
                <span class="text-[9px] font-bold uppercase">${t.name}</span>
            </label>
        `).join('');
    }

    function editSeries(id) {
        const s = db.series.find(x => x.id == id);
        document.getElementById('edit-id').value = s.id;
        document.getElementById('v-title').value = s.title;
        document.getElementById('v-thumb').value = s.thumb;
        document.getElementById('v-desc').value = s.desc;
        document.getElementById('ep-inputs').innerHTML = '';
        s.episodes.forEach(ep => addEpField(ep.title, ep.url));
        document.querySelectorAll('.v-tag-check').forEach(c => c.checked = s.tags.includes(parseInt(c.value)));
    }

    function resetForm() {
        document.getElementById('edit-id').value = '';
        document.getElementById('v-title').value = '';
        document.getElementById('v-thumb').value = '';
        document.getElementById('v-desc').value = '';
        document.getElementById('ep-inputs').innerHTML = '';
        document.querySelectorAll('.v-tag-check').forEach(c => c.checked = false);
    }

    // --- UTILS ---
    function tryLogin() {
        if(document.getElementById('admin-pass').value === '171088') {
            document.getElementById('login-modal').style.display = 'none';
            document.getElementById('admin-panel').style.display = 'flex';
            renderAdminSeries();
        } else alert("Chave inválida");
    }

    function showSection(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
        document.getElementById('section-' + id).classList.remove('hidden');
        if(id === 'mylist') renderMyList();
    }

    function openTab(id) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.getElementById('tab-' + id).classList.add('active');
    }

    function openLogin() { document.getElementById('login-modal').style.display = 'flex'; }
    function closeModal() { document.getElementById('series-modal').style.display = 'none'; document.getElementById('main-player').pause(); }

    window.onload = renderAll;
</script>
</body>
</html>
